#!/bin/bash

DOTFILES="$HOME/dotfiles"
COLOR_GRAY="\033[1;38;5;243m"
COLOR_BLUE="\033[1;34m"
COLOR_GREEN="\033[1;32m"
COLOR_RED="\033[1;31m"
COLOR_PURPLE="\033[1;35m"
COLOR_YELLOW="\033[1;33m"
COLOR_NONE="\033[0m"

logo() {

	echo -e "${COLOR_BLUE}
  ░░░░░░   ░░░░░░  ░░░░░░░ ░░░░░░░
  ▒▒   ▒▒ ▒▒    ▒▒      ▒▒ ▒▒
  ▒▒   ▒▒ ▒▒    ▒▒    ▒▒   ▒▒▒▒▒▒▒
  ▓▓   ▓▓ ▓▓    ▓▓   ▓▓         ▓▓
  ██████   ██████    ██    ███████\n${COLOR_NONE}"
}

menu() {

	echo -e "  ${COLOR_GRAY}OPTIONS${COLOR_NONE}"
	echo -e "    ${COLOR_GREEN}--link${COLOR_NONE}     ${COLOR_YELLOW}symlink dotfiles${COLOR_NONE}"
	echo -e "    ${COLOR_GREEN}--nvim${COLOR_NONE}     ${COLOR_YELLOW}setup neoviim config${COLOR_NONE}"
	echo -e "    ${COLOR_GREEN}--all${COLOR_NONE}      ${COLOR_YELLOW}do all the things${COLOR_NONE}\n"
}

title() {
	echo -e "\n  ${COLOR_PURPLE}$1${COLOR_NONE}"
	echo -e "  ${COLOR_GRAY}==============================${COLOR_NONE}\n"
}

error() {
	echo -e "    ${COLOR_RED}Error: ${COLOR_NONE}$1"
	exit 1
}

warning() {
	echo -e "    ${COLOR_YELLOW}Warning: ${COLOR_NONE}$1"
}

info() {
	echo -e "    ${COLOR_BLUE}Info: ${COLOR_NONE}$1"
}

success() {
	echo -e "    ${COLOR_GREEN}$1${COLOR_NONE}"
}

get_linkables() {
	find -H "$DOTFILES" -maxdepth 3 -name '*.symlink'
}

setup_symlinks() {
	title "Creating symlinks"

	for file in $(get_linkables); do
		target="$HOME/.$(basename "$file" '.symlink')"
		if [ -e "$target" ]; then
			info "~${target#$HOME} already exists... Skipping."
		else
			info "Creating symlink for $file"
			ln -s "$file" "$target"
		fi
	done

	echo -e
	info "installing to ~/.config"
	if [ ! -d "$HOME/.config" ]; then
		info "Creating ~/.config"
		mkdir -p "$HOME/.config"
	fi

	config_files=$(find "$DOTFILES/config" -path '**/config/*' -maxdepth 1 2>/dev/null)
	for config in $config_files; do
		target="$HOME/.config/$(basename "$config")"
		if [ -e "$target" ]; then
			info "~${target#$HOME} already exists... Skipping."
		else
			info "Creating symlink for $config"
			ln -s "$config" "$target"
		fi
	done
}

setup_nvim() {
	title "Setting up Neoviim"

	neorepo="https://github.com/5nik7/neoviim.git"
	neodir="$HOME/.neoviim"
	if [ -d "$neodir" ]; then
		info "${neodir} already exists... Skipping."
	else
		info "Cloning Neovim from $neorepo"
		git clone "$neorepo" "$neodir"
	fi

	cfgnvim="$HOME/.config/nvim"
		if ( -e "$filename" ]; then
    if [ "$(readlink $target_file)" = "$source_file" ]; then
      exit
    fi
    rm -rf "$target_file" && ln
		else
			info "Creating symlink for $neodir"
			ln -s "$neodir" "$filename"
		fi
}

case "$1" in
--link)
	clear
	logo
	setup_symlinks
	;;
--nvim)
	clear
	logo
	setup_nvim
	;;
--all)
	clear
	logo
	setup_symlinks
	setup_nvim
	;;
--help)
	clear
	logo
	menu
	exit 1
	;;
*)
	clear
	logo
	menu
	exit 1
	;;
esac

echo -e
success "Done.\n"
